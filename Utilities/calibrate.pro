pro calibrate,image,ns,nl;dir='a';read, dir, prompt='What directory  ';cd, dir;$cp *.hdr /photon/data1/tempopenr, 1,image;cd, '/photon/data1/temp'output=strcompress(image+'.cal')openw, 2, outputfline=fltarr(ns)line=bytarr(ns)calcoeffs96=[.00129,.00273,.00201,.0031,.00213,.00251]caloffsets96=[.036,.031,.029,-.018,-.003,.054]darksub=bytarr(6)year=1996ncoeff=fltarr(6)noffset=fltarr(6)read, darksub1,prompt='Darksub 1   'read, darksub2,prompt='Darksub 2   'read, darksub3,prompt='Darksub 3   'read, darksub4,prompt='Darksub 4   'darksub(0)=darksub1darksub(1)=darksub2darksub(2)=darksub3darksub(3)=darksub4read, year, prompt='What year   'if (year ne 1996) then begin  for i=0,5 do begin   read, ncoeff1,prompt='Normalization coeff  '   ncoeff(i)=ncoeff1 endfor for i=0,5 do begin   read, noffset1,prompt='Normalization offset  '   noffset(i)=noffset1 endforendiffor j=0,5 do begin;      if (j eq 5) then point_lun, 1, float(ns)*float(nl)*6.0      print, 'band',j      for i=0,nl-1 do begin      readu,1,line      index=where(line le 0, count)      fline=float(line)      fline=fline-darksub(j)            index2=where(line ne 0,count2)       if ((year ne 1996) and (count2 gt 0)) then $         fline(index2)=fline(index2)*ncoeff(j)+noffset(j)             if (count2 gt 0) then $          fline(index2)=fline(index2)*calcoeffs96(j)+caloffsets96(j)            if (count gt 0) then fline(index)=0       writeu, 2, fline       endforendforfree_lun, 1,2end